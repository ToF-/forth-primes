# Using primes to find primes

Not all number have to be tried as divisors to check if a number is prime: the fundamental theorem of arithmetics says that every integer greater than 1 can be uniquely represented as a product of prime numbers. The number 47 for instance is not a multiple of 2, so there is no point in trying to to divide it by 4, 6, and so on, nor by 9, 15, and so on.

We can improve the performance of our program by using the prime numbers as the list of divisors. That means we need to have a table of these divisors, up to a number, let's say 1000. 

Here's a program that output the code for such a table initialization:

<pre><span style="color:#669999; font-weight:bold;">\</span> <span style="color:#669999; font-weight:bold;">print-init-168-primes.fs output code for prime divisor table init
</span><span style="color:#3D3D5C; font-weight:bold;">REQUIRE</span> <span style="color:#800000; font-weight:bold;">trial.fs</span>

<span style="color:#F07F00; font-weight:bold;">:</span> <span style="color:#336699; font-weight:bold;">.PRIME-TABLE</span>
    <span style="color:#800000; font-weight:bold;">0</span> <span style="color:#800000; font-weight:bold;">1000</span> <span style="color:#800000; font-weight:bold;">2</span> <span style="color:#993300; font-weight:bold;">DO</span>
        <span style="color:#993300; font-weight:bold;">I</span> <span style="color:#800000; font-weight:bold;">IS-PRIME?</span> <span style="color:#993300; font-weight:bold;">IF</span>
            <span style="color:#993300; font-weight:bold;">I</span> <span style="color:#800000; font-weight:bold;">4</span> <span style="color:#CC6600; font-weight:bold;">.R</span> <span style="color:#008000; font-weight:bold;">."</span> <span style="color:#008000; font-weight:bold;"> ,"</span>
            <span style="color:#CC6600; font-weight:bold;">1+</span>
            <span style="color:#009999; font-weight:bold;">DUP</span> <span style="color:#800000; font-weight:bold;">14</span> <span style="color:#CC6600; font-weight:bold;">MOD</span> <span style="color:#CC6600; font-weight:bold;">0=</span> <span style="color:#993300; font-weight:bold;">IF</span>
                <span style="color:#3D3D5C; font-weight:bold;">CR</span>
            <span style="color:#993300; font-weight:bold;">THEN</span>
        <span style="color:#993300; font-weight:bold;">THEN</span>
    <span style="color:#993300; font-weight:bold;">LOOP</span> <span style="color:#009999; font-weight:bold;">DROP</span> <span style="color:#3D3D5C; font-weight:bold;">CR</span> <span style="color:#993300; font-weight:bold;">;</span>

<span style="color:#336699; font-weight:bold;">.PRIME-TABLE</span>
<span style="color:#3D3D5C; font-weight:bold;">BYE</span>
</pre>

Lauching this program will output the code we need:
```
> gforth print-init-168-primes
   2 ,   3 ,   5 ,   7 ,  11 ,  13 ,  17 ,  19 ,  23 ,  29 ,  31 ,  37 ,  41 ,  43 ,
  47 ,  53 ,  59 ,  61 ,  67 ,  71 ,  73 ,  79 ,  83 ,  89 ,  97 , 101 , 103 , 107 ,
 109 , 113 , 127 , 131 , 137 , 139 , 149 , 151 , 157 , 163 , 167 , 173 , 179 , 181 ,
 191 , 193 , 197 , 199 , 211 , 223 , 227 , 229 , 233 , 239 , 241 , 251 , 257 , 263 ,
 269 , 271 , 277 , 281 , 283 , 293 , 307 , 311 , 313 , 317 , 331 , 337 , 347 , 349 ,
 353 , 359 , 367 , 373 , 379 , 383 , 389 , 397 , 401 , 409 , 419 , 421 , 431 , 433 ,
 439 , 443 , 449 , 457 , 461 , 463 , 467 , 479 , 487 , 491 , 499 , 503 , 509 , 521 ,
 523 , 541 , 547 , 557 , 563 , 569 , 571 , 577 , 587 , 593 , 599 , 601 , 607 , 613 ,
 617 , 619 , 631 , 641 , 643 , 647 , 653 , 659 , 661 , 673 , 677 , 683 , 691 , 701 ,
 709 , 719 , 727 , 733 , 739 , 743 , 751 , 757 , 761 , 769 , 773 , 787 , 797 , 809 ,
 811 , 821 , 823 , 827 , 829 , 839 , 853 , 857 , 859 , 863 , 877 , 881 , 883 , 887 ,
 907 , 911 , 919 , 929 , 937 , 941 , 947 , 953 , 967 , 971 , 977 , 983 , 991 , 997 ,
```
We can capture this output and use it in our new program:

<pre><span style="color:#669999; font-weight:bold;">\</span> <span style="color:#669999; font-weight:bold;">p-trial.fs   compute primes by trial division algorithm, using prime divisors
</span>
<span style="color:#F07F00; font-weight:bold;">CREATE</span> <span style="color:#336699; font-weight:bold;">SMALL-PRIMES</span>
   <span style="color:#800000; font-weight:bold;">2</span> <span style="color:#CC3300; font-weight:bold;">,</span>   <span style="color:#800000; font-weight:bold;">3</span> <span style="color:#CC3300; font-weight:bold;">,</span>   <span style="color:#800000; font-weight:bold;">5</span> <span style="color:#CC3300; font-weight:bold;">,</span>   <span style="color:#800000; font-weight:bold;">7</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">11</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">13</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">17</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">19</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">23</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">29</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">31</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">37</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">41</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">43</span> <span style="color:#CC3300; font-weight:bold;">,</span>
  <span style="color:#800000; font-weight:bold;">47</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">53</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">59</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">61</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">67</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">71</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">73</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">79</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">83</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">89</span> <span style="color:#CC3300; font-weight:bold;">,</span>  <span style="color:#800000; font-weight:bold;">97</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">101</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">103</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">107</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">109</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">113</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">127</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">131</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">137</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">139</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">149</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">151</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">157</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">163</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">167</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">173</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">179</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">181</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">191</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">193</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">197</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">199</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">211</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">223</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">227</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">229</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">233</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">239</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">241</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">251</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">257</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">263</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">269</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">271</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">277</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">281</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">283</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">293</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">307</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">311</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">313</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">317</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">331</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">337</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">347</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">349</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">353</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">359</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">367</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">373</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">379</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">383</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">389</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">397</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">401</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">409</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">419</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">421</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">431</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">433</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">439</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">443</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">449</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">457</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">461</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">463</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">467</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">479</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">487</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">491</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">499</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">503</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">509</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">521</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">523</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">541</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">547</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">557</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">563</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">569</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">571</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">577</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">587</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">593</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">599</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">601</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">607</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">613</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">617</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">619</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">631</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">641</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">643</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">647</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">653</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">659</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">661</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">673</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">677</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">683</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">691</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">701</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">709</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">719</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">727</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">733</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">739</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">743</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">751</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">757</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">761</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">769</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">773</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">787</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">797</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">809</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">811</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">821</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">823</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">827</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">829</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">839</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">853</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">857</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">859</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">863</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">877</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">881</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">883</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">887</span> <span style="color:#CC3300; font-weight:bold;">,</span>
 <span style="color:#800000; font-weight:bold;">907</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">911</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">919</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">929</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">937</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">941</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">947</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">953</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">967</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">971</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">977</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">983</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">991</span> <span style="color:#CC3300; font-weight:bold;">,</span> <span style="color:#800000; font-weight:bold;">997</span> <span style="color:#CC3300; font-weight:bold;">,</span>

<span style="color:#800000; font-weight:bold;">168</span> <span style="color:#F07F00; font-weight:bold;">CONSTANT</span> <span style="color:#336699; font-weight:bold;">SMALL-PRIMES-MAX</span>
<span style="color:#800000; font-weight:bold;">1000</span> <span style="color:#F07F00; font-weight:bold;">CONSTANT</span> <span style="color:#336699; font-weight:bold;">SMALL-PRIME-LIMIT</span>

<span style="color:#F07F00; font-weight:bold;">:</span> <span style="color:#336699; font-weight:bold;">NTH-PRIME</span> <span style="color:#669999; font-weight:bold;">(</span> <span style="color:#669999; font-weight:bold;">n -- p )</span>
    <span style="color:#CC3300; font-weight:bold;">CELLS</span> <span style="color:#336699; font-weight:bold;">SMALL-PRIMES</span> <span style="color:#CC6600; font-weight:bold;">+</span> <span style="color:#CC3300; font-weight:bold;">@</span> <span style="color:#993300; font-weight:bold;">;</span>
</pre>
The word `NTH-PRIME`, given an index < 168 on the stack, fetches the nth prime in the table.
<pre>
<span style="color:#F07F00; font-weight:bold;">:</span> <span style="color:#336699; font-weight:bold;">SQUARED</span> <span style="color:#669999; font-weight:bold;">(</span> <span style="color:#669999; font-weight:bold;">n -- n² )</span>
    <span style="color:#009999; font-weight:bold;">DUP</span> <span style="color:#CC6600; font-weight:bold;">*</span> <span style="color:#993300; font-weight:bold;">;</span>

<span style="color:#F07F00; font-weight:bold;">:</span> <span style="color:#336699; font-weight:bold;">IS-MULTIPLE?</span> <span style="color:#669999; font-weight:bold;">(</span> <span style="color:#669999; font-weight:bold;">m,n -- f )</span>
    <span style="color:#CC6600; font-weight:bold;">MOD</span> <span style="color:#CC6600; font-weight:bold;">0=</span> <span style="color:#993300; font-weight:bold;">;</span>

<span style="color:#336699; font-weight:bold;">SMALL-PRIME-LIMIT</span> <span style="color:#336699; font-weight:bold;">SQUARED</span> <span style="color:#F07F00; font-weight:bold;">CONSTANT</span> <span style="color:#336699; font-weight:bold;">PRIME-LIMIT</span>
</pre>
Now our main word will loop over the `SMALL-PRIMES` table to try each divisor P for the argument N. If P² > N, we leave the loop, and the result flag will still be true. If D divides N, we also leave the loop, but change the result flag to `FALSE`first.
<pre>
<span style="color:#F07F00; font-weight:bold;">:</span> <span style="color:#336699; font-weight:bold;">IS-PRIME?</span> <span style="color:#669999; font-weight:bold;">(</span> <span style="color:#669999; font-weight:bold;">n -- f )</span>
    <span style="color:#3D3D5C; font-weight:bold;">ASSERT(</span> <span style="color:#009999; font-weight:bold;">DUP</span> <span style="color:#336699; font-weight:bold;">PRIME-LIMIT</span> <span style="color:#CC6600; font-weight:bold;">&lt;=</span> <span style="color:#3D3D5C; font-weight:bold;">)</span>
    <span style="color:#CC6600; font-weight:bold;">TRUE</span> <span style="color:#009999; font-weight:bold;">SWAP</span>
    <span style="color:#336699; font-weight:bold;">SMALL-PRIMES-MAX</span> <span style="color:#800000; font-weight:bold;">0</span> <span style="color:#993300; font-weight:bold;">DO</span>
        <span style="color:#993300; font-weight:bold;">I</span> <span style="color:#336699; font-weight:bold;">NTH-PRIME</span>
        <span style="color:#009999; font-weight:bold;">2DUP</span> <span style="color:#336699; font-weight:bold;">SQUARED</span> <span style="color:#CC6600; font-weight:bold;">&lt;</span> <span style="color:#993300; font-weight:bold;">IF</span>
            <span style="color:#009999; font-weight:bold;">DROP</span> <span style="color:#993300; font-weight:bold;">LEAVE</span>
        <span style="color:#993300; font-weight:bold;">ELSE</span>
            <span style="color:#009999; font-weight:bold;">OVER</span> <span style="color:#009999; font-weight:bold;">SWAP</span> <span style="color:#336699; font-weight:bold;">IS-MULTIPLE?</span> <span style="color:#993300; font-weight:bold;">IF</span>
                <span style="color:#009999; font-weight:bold;">NIP</span> <span style="color:#CC6600; font-weight:bold;">FALSE</span> <span style="color:#009999; font-weight:bold;">SWAP</span> <span style="color:#993300; font-weight:bold;">LEAVE</span>
            <span style="color:#993300; font-weight:bold;">THEN</span>
        <span style="color:#993300; font-weight:bold;">THEN</span>
    <span style="color:#993300; font-weight:bold;">LOOP</span> <span style="color:#009999; font-weight:bold;">DROP</span> <span style="color:#993300; font-weight:bold;">;</span>
</pre>
The top level words are unchanged:
<pre>
<span style="color:#F07F00; font-weight:bold;">:</span> <span style="color:#336699; font-weight:bold;">.PRIMES</span> <span style="color:#669999; font-weight:bold;">(</span> <span style="color:#669999; font-weight:bold;">n -- )</span>
    <span style="color:#CC6600; font-weight:bold;">1+</span> <span style="color:#800000; font-weight:bold;">2</span> <span style="color:#993300; font-weight:bold;">DO</span>
        <span style="color:#993300; font-weight:bold;">I</span> <span style="color:#336699; font-weight:bold;">IS-PRIME?</span> <span style="color:#993300; font-weight:bold;">IF</span>
            <span style="color:#993300; font-weight:bold;">I</span> <span style="color:#CC6600; font-weight:bold;">.</span> <span style="color:#3D3D5C; font-weight:bold;">CR</span>
        <span style="color:#993300; font-weight:bold;">THEN</span>
   <span style="color:#993300; font-weight:bold;">LOOP</span> <span style="color:#993300; font-weight:bold;">;</span>

<span style="color:#F07F00; font-weight:bold;">:</span> <span style="color:#336699; font-weight:bold;">PRIME-COUNT</span> <span style="color:#669999; font-weight:bold;">(</span> <span style="color:#669999; font-weight:bold;">n -- t )</span>
    <span style="color:#800000; font-weight:bold;">0</span> <span style="color:#009999; font-weight:bold;">SWAP</span>
    <span style="color:#CC6600; font-weight:bold;">1+</span> <span style="color:#800000; font-weight:bold;">2</span> <span style="color:#993300; font-weight:bold;">DO</span>
        <span style="color:#993300; font-weight:bold;">I</span> <span style="color:#336699; font-weight:bold;">IS-PRIME?</span> <span style="color:#993300; font-weight:bold;">IF</span>
            <span style="color:#CC6600; font-weight:bold;">1+</span>
        <span style="color:#993300; font-weight:bold;">THEN</span>
    <span style="color:#993300; font-weight:bold;">LOOP</span> <span style="color:#993300; font-weight:bold;">;</span>
</pre>
Now our performance test call:
```
gforth p-trials.fs -e "1000000 PRIME-COUNT . BYE"
```
takes about 0.3 seconds!
